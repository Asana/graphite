#!/bin/sh
exec 2>&1
exec uwsgi \
--processes <%= node["graphite"]["uwsgi"]["workers"] %> \
<% if node["graphite"]["uwsgi"]["plugins"].length > 0 -%>
--plugins <%= node["graphite"]["uwsgi"]["plugins"].join(",") %> \
<% end -%>
--pythonpath <%= node["graphite"]["base_dir"] %>/lib \
--pythonpath <%= node["graphite"]["base_dir"] %>/webapp/graphite \
--wsgi-file <%= node["graphite"]["base_dir"] %>/conf/graphite.wsgi.example \
--uid <%= node["graphite"]["user"] %> \
--gid <%= node["graphite"]["group"] %> \
--no-orphans \
<% if node["graphite"]["uwsgi"]["master"] -%>
--master \
<% end -%>
--procname graphite-web \
--die-on-term \
--socket <%= node["graphite"]["uwsgi"]["socket"] %> \
--chmod-socket <%=default["graphite"]["uwsgi"]["chmod_socket"] %>
